<div class="bg-gray-100 min-h-screen font-sans p-4 sm:p-8">
  <div class="max-w-4xl mx-auto">
    <header class="mb-8">
      <h1 class="text-4xl font-bold text-purple-800 flex items-center gap-3">ğŸ² Bingo Virtual Educativo</h1>
      <div class="flex items-center gap-4 mt-2 text-sm text-gray-600">
        <p><strong>Estado:</strong> <span class="text-green-600 font-semibold">Funcionando</span></p>
        <p><strong>ConexiÃ³n:</strong> 
          <span [ngClass]="{'text-green-600': estaConectado, 'text-red-600': !estaConectado}" class="font-semibold">
            {{ estaConectado ? 'âœ… Conectado' : 'âŒ Desconectado' }}
          </span>
        </p>
      </div>
    </header>

    <!-- Lobby View -->
    <div *ngIf="vistaActual === 'lobby'" class="bg-white p-8 rounded-xl shadow-lg animate-fade-in">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ  Lobby - Crea o Ãºnete a una sala</h2>
      <div class="space-y-4">
        <div>
          <label for="playerName" class="block text-sm font-medium text-gray-700">Tu nombre</label>
          <input id="playerName" [(ngModel)]="nombreJugador" placeholder="Ingresa tu nombre" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm">
        </div>
        <div>
          <label for="roomName" class="block text-sm font-medium text-gray-700">Nombre de la sala</label>
          <input id="roomName" [(ngModel)]="nombreSala" placeholder="Mi sala de bingo" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm">
        </div>
      </div>
      <button (click)="crearSala()" class="mt-6 w-full inline-flex justify-center py-3 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors duration-200">
        ğŸ® Crear Sala
      </button>
  </div>

    <!-- Room View -->
    <div *ngIf="vistaActual === 'sala' && salaActual" class="bg-white p-8 rounded-xl shadow-lg animate-fade-in">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">ğŸšª Sala: {{ salaActual.nombre }}</h2>
      <p class="text-sm text-gray-500 mb-6">ID de la Sala: <code class="bg-gray-200 text-purple-800 font-mono px-2 py-1 rounded">{{ salaActual.id }}</code> (Â¡CompÃ¡rtelo!)</p>
      
      <div class="flex flex-col md:flex-row gap-8">
        <!-- Players List -->
        <div class="md:w-1/3">
          <h4 class="text-lg font-semibold mb-3">ğŸ‘¥ Jugadores ({{ jugadores.length }})</h4>
          <ul class="space-y-2">
            <li *ngFor="let jugador of jugadores; let i = index" class="bg-gray-50 p-3 rounded-lg flex items-center gap-3">
              <span class="text-xl">{{ i === 0 ? 'ğŸ‘‘' : 'ğŸ‘¤' }}</span>
              <span class="font-medium text-gray-700">{{ jugador.nombre }}</span>
            </li>
          </ul>
          <button *ngIf="puedeIniciarJuego" (click)="iniciarJuegoMultijugador()" class="mt-4 w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-orange-500 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors duration-200">
            ğŸš€ Iniciar Juego
          </button>
        </div>
        
        <!-- Chat -->
        <div class="md:w-2/3">
          <h4 class="text-lg font-semibold mb-3">ğŸ’¬ Chat de la Sala</h4>
          <div class="h-48 overflow-y-auto border rounded-lg p-3 bg-gray-50 space-y-2">
            <div *ngFor="let msg of mensajesChat" class="text-sm">
              <span class="text-gray-500">[{{ formatearTiempo(msg.timestamp) }}]</span> 
              <strong class="text-purple-700">{{ msg.jugador }}:</strong> 
              <span class="text-gray-800">{{ msg.mensaje }}</span>
            </div>
          </div>
          <div class="mt-2 flex gap-2">
            <textarea [(ngModel)]="nuevoMensaje" (keydown)="onEnterChat($event)" placeholder="Escribe un mensaje..." class="flex-grow block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm"></textarea>
            <button (click)="enviarMensaje()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">Enviar</button>
          </div>
        </div>
      </div>

      <hr class="my-6">
      <button (click)="volverAlLobby()" class="text-sm text-red-600 hover:text-red-800 font-medium transition-colors duration-200">â† Volver al Lobby</button>
    </div>
  
    <!-- Game View -->
    <div *ngIf="vistaActual === 'juego'" class="bg-white p-8 rounded-xl shadow-lg animate-fade-in">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800">ğŸ¯ Â¡A Jugar al Bingo! ğŸ¯</h2>
        <p class="text-gray-600">Jugador: <span class="font-semibold text-purple-700">{{ jugadorActual?.nombre }}</span></p>
      </div>

      <!-- Called Number Display -->
      <div class="text-center my-8">
        <p class="text-lg text-gray-500">NÃºmero Sorteado</p>
        <div class="inline-block bg-purple-600 text-white rounded-full w-24 h-24 flex items-center justify-center text-5xl font-bold shadow-lg animate-pulse">
          {{ numeroActual || '...' }}
        </div>
      </div>

      <!-- Bingo Card -->
      <div class="grid grid-cols-5 gap-1 md:gap-2 max-w-sm mx-auto bg-gray-200 p-2 rounded-lg">
        <div *ngFor="let letra of ['B', 'I', 'N', 'G', 'O']" class="text-center font-bold text-xl text-purple-800">{{ letra }}</div>
        <ng-container *ngFor="let fila of carton; let i = index">
          <button *ngFor="let celda of fila; let j = index"
                  (click)="toggleCelda(i, j)"
                  [ngClass]="{
                    'bg-purple-200 text-purple-800 ring-2 ring-purple-500': celda.marcada,
                    'bg-white hover:bg-purple-50': !celda.marcada,
                    'bg-yellow-400 text-white': celda.esLibre,
                    'cursor-not-allowed opacity-50': !numeroDisponible(celda.numero) && !celda.esLibre && !celda.marcada
                  }"
                  class="aspect-square flex items-center justify-center text-lg md:text-2xl font-bold rounded-md shadow-sm transition-all duration-200">
            <span *ngIf="!celda.esLibre">{{ celda.numero }}</span>
            <span *ngIf="celda.esLibre" class="text-2xl">â˜…</span>
          </button>
        </ng-container>
      </div>

      <!-- Called Numbers History Board -->
      <div class="mt-8">
        <h3 class="text-lg font-semibold text-center text-gray-700 mb-3">NÃºmeros Sorteados</h3>
        <div class="grid grid-cols-15 gap-1 text-center text-xs p-2 bg-gray-100 rounded-lg">
          <div *ngFor="let n of [].constructor(75); let i = index"
               [ngClass]="{
                 'bg-purple-500 text-white font-bold': numerosSorteados.includes(i + 1),
                 'bg-white': !numerosSorteados.includes(i + 1)
               }"
               class="w-6 h-6 flex items-center justify-center rounded-full shadow-sm">
            {{ i + 1 }}
          </div>
        </div>
      </div>

    </div>
  
    <footer class="mt-12 text-center text-sm text-gray-500">
      <div class="max-w-md mx-auto bg-white/60 p-4 rounded-lg shadow-inner backdrop-blur-sm">
        <h3 class="font-bold text-gray-700 mb-2">ğŸ“š InformaciÃ³n del Proyecto</h3>
        <p><strong>Autores:</strong> {{ autores }}</p>
        <p><strong>Materia:</strong> Algoritmos y Estructuras de Datos III</p>
        <p><strong>Profesor:</strong> {{ profesor }}</p>
      </div>
    </footer>
</div>
